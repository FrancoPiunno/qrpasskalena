<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Lista de Entradas</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}?v=7">
    <link rel="shortcut icon" type="x-icon" href="{{ url_for('static', filename='webicon.png') }}">
    <style>@import url('https://fonts.googleapis.com/css2?family=Rubik:ital,wght@0,300..900;1,300..900&display=swap');</style>
</head>
<body>
    
    <!-- Contenedor Premium -->
    <div class="main-layout events-page">
        
        <div class="events-container">
            
            <!-- Encabezado Glass -->
            <div class="events-header">
                <div class="search-box">
                    <input type="text" placeholder="Buscar entrada..." id="searchInput" onkeyup="filterTable()">
                </div>
                
                <div class="action-buttons">
                    <a href="{{ url_for('registrar_entrada') }}" class="btn-create">Generar</a>
                    <a href="{{ url_for('lista_eventos') }}" class="btn-secondary">Eventos</a>
                </div>
            </div>

            <!-- Filtros Rápidos (Chips) -->
            {% if conteo_eventos and conteo_eventos|length > 0 %}
            <div class="d-flex flex-wrap gap-2 justify-content-center">
                {% for evento, cantidad in conteo_eventos.items() %}
                <button class="btn btn-sm btn-outline-light rounded-pill px-3" onclick="setFilter('{{ evento|e }}')">
                    {{ evento }} <span class="badge bg-light text-dark ms-1">{{ cantidad }}</span>
                </button>
                {% endfor %}
            </div>
            {% endif %}

            <!-- Tabla de Datos -->
            <div class="table-responsive">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Evento</th>
                            <th>Nombre</th>
                            <th>Teléfono</th>
                            <th>Estado</th>
                            <th class="text-center">QR</th>
                            <th class="text-center">Acción</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for entrada in entradas %}
                        <tr>
                            <td data-label="Evento">{{ entrada.evento }}</td>
                            <td data-label="Nombre">{{ entrada.nombre }}</td>    
                            <td data-label="Teléfono">{{ entrada.telefono }}</td>                
                            <td data-label="Estado">
                                <span class="badge {{ 'bg-success' if entrada.estado == 'Usada' else 'bg-warning text-dark' }}">
                                    {{ entrada.estado }}
                                </span>
                            </td>
                            <td data-label="QR" class="text-center">
                                <a href="{{ url_for('descargar_qr', id=entrada.id)}}" class="btn-delete" style="background: rgba(255,255,255,0.2); color:white; width:auto; height:30px; padding:0 10px; border-radius:15px; font-size:0.8rem; text-decoration:none;">
                                    Descargar
                                </a>
                            </td>
                            <td data-label="Acción" class="text-center">
                                <form method="POST" action="{{ url_for('eliminar_entrada', entrada_id=entrada.id) }}" onsubmit="return confirm('¿Eliminar esta entrada?')">
                                    <button type="submit" class="btn-delete">x</button>
                                </form>
                            </td>
                        </tr>
                        {% endfor %}
                        {% if not entradas %}
                        <tr>
                            <td colspan="6" class="text-center text-muted py-5">No hay entradas generadas todavía.</td>
                        </tr>
                        {% endif %}
                    </tbody>
                </table>
            </div>

        </div>

        <!-- Botón flotante para salir -->
        <div class="nav-logout">
            <a href="{{ url_for('index') }}" class="btn">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path fill="#ffffff" d="M575.8 255.5c0 18-15 32.1-32 32.1l-32 0 .7 160.2c0 2.7-.2 5.4-.5 8.1l-.8 16.2c-.6 16.7-14.2 30.1-30.8 30.1l-61.2 0c-26.5 0-48-21.5-48-48l0-58.8c0-2.6-.5-5.3-2.3-7.2l-21.3-20.9c-10.8-10.6-26.4-15.5-41.2-12.9l-22.3 3.9c-7.9 1.4-14.8 6.1-18.7 13.1l-18.1 31.8c-10.4 18.3-29.8 29.5-50.8 29.5L68 431.7c-17.7 0-32-14.3-32-32l0-143.7L19.5 256c-18 0-32.5-14-32.5-32l0-18.5c0-1.9 .2-3.8 .6-5.7C5.4 196.8 14 181.7 6.1 173.1c98.2 87.5 98.7 87.9 101.6c4-7.5 9.4-14.3 16-20.3L258.8 35.9C271.7 24.3 288.7 18 306 18s34.3 6.3 47.2 18l158 142.3c3.4 3.1 6.5 6.6 9.3 10.5c3.2-3.4 6-7.3 8.3-11.6c-2.7-4.1-5.7-8-9-11.7l-9.6-10.8C502.6 146.9 496 134.9 496 122.3l0-64c0-17.7-14.3-32-32-32l-32 0c-17.7 0-32 14.3-32 32l0 19.6L375.4 56.4c17.5-15.8 40.5-24.4 64.2-24.4s46.7 8.6 64.2 24.4L640.7 178c10.5 9.4 17.2 22.8 17.2 37.6l0 10.9c0 17.3-14 31.3-31.3 31.3c-2.3 0-4.6-.2-6.8-.7c-.6 2.4-.9 4.9-.9 7.4l0 17.6c-12.4 5-25.9 7.7-40 7.7c-9 0-17.8-1-26.2-2.9z"/></svg>
            </a>
        </div>

    </div>

    <script>
        function filterTable() {
            const input = document.getElementById('searchInput');
            const filter = input.value.toLowerCase();
            const table = document.querySelector('table');
            const rows = table.getElementsByTagName('tr');
            for (let i = 1; i < rows.length; i++) {
                const cells = rows[i].getElementsByTagName('td');
                let found = false;
                for (let j = 0; j < cells.length; j++) {
                    if (cells[j].textContent.toLowerCase().includes(filter)) {
                        found = true;
                        break;
                    }
                }
                rows[i].style.display = found ? '' : 'none';
            }
        }

        function setFilter(eventName) {
            document.getElementById('searchInput').value = eventName;
            filterTable();
        }
    </script>
</body>
</html>